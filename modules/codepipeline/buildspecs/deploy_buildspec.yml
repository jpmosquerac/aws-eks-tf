version: 0.2
phases:
  pre_build:
    commands:
      # - aws sts get-caller-identity
      # - aws eks update-kubeconfig --region us-east-1 --name py-grpc-cluster
      - touch /etc/yum.repos.d/kubernetes.repo
      - cat <<EOF | tee /etc/yum.repos.d/kubernetes.repo
        [kubernetes]
        name=Kubernetes
        baseurl=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/
        enabled=1
        gpgcheck=1
        gpgkey=https://pkgs.k8s.io/core:/stable:/v1.29/rpm/repodata/repomd.xml.key
        EOF
      - yum update
      - yum install -y kubectl
      - kubectl get svc
      - kubectl get nodes

  build:
    commands:
      - pwd